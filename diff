<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grelha de Avalia√ß√£o Oral</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; padding: 20px; max-width: 800px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h1 { color: #2c3e50; text-align: center; }
        h2 { border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 0; color: #444; }
        
        .form-group { margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        label { font-weight: bold; color: #555; width: 70%; }
        input[type="number"], input[type="text"] { padding: 8px; width: 80px; text-align: center; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; }
        input[type="text"] { width: 100%; }
        
        .weight-badge { font-size: 0.8em; background: #e0e0e0; padding: 2px 6px; border-radius: 4px; color: #555; margin-left: 5px; }
        .weight-double { background: #ffe082; color: #d35400; font-weight: bold; }

        .result-box { background-color: #e8f5e9; padding: 15px; border-radius: 8px; text-align: center; margin-top: 20px; border: 1px solid #c8e6c9; }
        .total-score { font-size: 2em; font-weight: bold; color: #2e7d32; }
        
        button { width: 100%; padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.2s; margin-top: 10px; }
        .btn-add { background-color: #3498db; color: white; }
        .btn-add:hover { background-color: #2980b9; }
        .btn-export { background-color: #27ae60; color: white; margin-top: 20px; }
        .btn-export:hover { background-color: #219150; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        th { background-color: #f8f9fa; color: #333; }
        .col-nome { text-align: left; }
    </style>
</head>
<body>

    <h1>Avalia√ß√£o Oral em Tempo Real</h1>

    <div class="card">
        <h2>Novo Registo</h2>
        <div style="margin-bottom: 15px;">
            <label style="display:block; margin-bottom:5px;">Nome do Aluno:</label>
            <input type="text" id="nomeAluno" placeholder="Ex: Jo√£o Silva">
        </div>

        <div class="form-group">
            <label>1. Estrutura e Organiza√ß√£o <span class="weight-badge">x1</span></label>
            <input type="number" id="c1" min="0" max="20" value="0" oninput="calcular()">
        </div>
        <div class="form-group">
            <label>2. Conte√∫do e Argumenta√ß√£o <span class="weight-badge">x1</span></label>
            <input type="number" id="c2" min="0" max="20" value="0" oninput="calcular()">
        </div>
        <div class="form-group">
            <label>3. Criatividade e Estilo <span class="weight-badge">x1</span></label>
            <input type="number" id="c3" min="0" max="20" value="0" oninput="calcular()">
        </div>
        <div class="form-group">
            <label>4. Adequa√ß√£o e Respeito <span class="weight-badge">x1</span></label>
            <input type="number" id="c4" min="0" max="20" value="0" oninput="calcular()">
        </div>
        <div class="form-group">
            <label>5. Express√£o Oral <span class="weight-badge weight-double">x2 (Dobro)</span></label>
            <input type="number" id="c5" min="0" max="20" value="0" oninput="calcular()">
        </div>

        <div class="result-box">
            <div>Nota Final Calculada:</div>
            <div class="total-score" id="notaFinal">0.0</div>
        </div>

        <button class="btn-add" onclick="adicionarAluno()">üíæ Guardar Aluno na Lista</button>
    </div>

    <div class="card">
        <h2>Lista da Turma</h2>
        <table id="tabelaTurma">
            <thead>
                <tr>
                    <th class="col-nome">Nome</th>
                    <th>Estrut.</th>
                    <th>Cont.</th>
                    <th>Criat.</th>
                    <th>Adeq.</th>
                    <th>Oral (x2)</th>
                    <th>Final</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
        <button class="btn-export" onclick="exportarExcel()">üì• Descarregar Tabela para Excel</button>
    </div>

    <script>
        let turma = [];

        function calcular() {
            // Ir buscar os valores
            let c1 = parseFloat(document.getElementById('c1').value) || 0;
            let c2 = parseFloat(document.getElementById('c2').value) || 0;
            let c3 = parseFloat(document.getElementById('c3').value) || 0;
            let c4 = parseFloat(document.getElementById('c4').value) || 0;
            let c5 = parseFloat(document.getElementById('c5').value) || 0;

            // F√≥rmula: (Soma dos simples + Duplo*2) / 6
            let final = (c1 + c2 + c3 + c4 + (c5 * 2)) / 6;

            // Mostrar no ecr√£ (1 casa decimal)
            document.getElementById('notaFinal').innerText = final.toFixed(1);
            return final.toFixed(1); // Devolve string formatada
        }

        function adicionarAluno() {
            let nome = document.getElementById('nomeAluno').value;
            if (nome === "") { alert("Escreve o nome do aluno!"); return; }

            let nota = calcular();
            
            // Guardar dados
            let alunoData = {
                nome: nome,
                c1: document.getElementById('c1').value,
                c2: document.getElementById('c2').value,
                c3: document.getElementById('c3').value,
                c4: document.getElementById('c4').value,
                c5: document.getElementById('c5').value,
                final: nota.replace('.', ',') // Formato PT para Excel
            };
            turma.push(alunoData);

            // Adicionar √† tabela visual
            let tabela = document.getElementById('tabelaTurma').getElementsByTagName('tbody')[0];
            let novaLinha = tabela.insertRow();
            novaLinha.innerHTML = `
                <td class="col-nome">${alunoData.nome}</td>
                <td>${alunoData.c1}</td>
                <td>${alunoData.c2}</td>
                <td>${alunoData.c3}</td>
                <td>${alunoData.c4}</td>
                <td><b>${alunoData.c5}</b></td>
                <td style="font-weight:bold; color: #2e7d32;">${alunoData.final}</td>
            `;

            // Limpar formul√°rio para o pr√≥ximo
            document.getElementById('nomeAluno').value = "";
            document.getElementById('c1').value = 0;
            document.getElementById('c2').value = 0;
            document.getElementById('c3').value = 0;
            document.getElementById('c4').value = 0;
            document.getElementById('c5').value = 0;
            calcular();
            document.getElementById('nomeAluno').focus();
        }

        function exportarExcel() {
            if(turma.length === 0) { alert("Ainda n√£o avaliaste ningu√©m!"); return; }

            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Nome;Estrutura;Conte√∫do;Criatividade;Adequa√ß√£o;Express√£o Oral (x2);Nota Final\n";

            turma.forEach(function(row) {
                csvContent += `${row.nome};${row.c1};${row.c2};${row.c3};${row.c4};${row.c5};${row.final}\n`;
            });

            var encodedUri = encodeURI(csvContent);
            var link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "Avaliacao_Oral_Turma.csv");
            document.body.appendChild(link);
            link.click();
        }
    </script>
</body>
</html>
